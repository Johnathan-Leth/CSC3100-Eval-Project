<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Group Survey</title>
    <link rel='icon' href='images/hippoLogo.png' type='image/png'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH' crossorigin='anonymous'>
    <link href='https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/yeti/bootstrap.min.css' rel='stylesheet'>
</head>
<body class="bg-dark">
    <div class='d-flex justify-content-center align-items-center vh-100'>
        <form class = 'card col-12 col-md-5' id='frmRegister'>
            <div class= 'card-body'>
                <h2 class = 'text-center text-primary'>Register</h2>
                <input id='regEmail'  class='form-control mt-2' type='email' aria-label="email" placeholder="Email">
                <input id='regPassword' class='form-control mt-2' type='password' aria-label="password" placeholder="Password">
                <input id='regPasswordConfirm' class='form-control mt-2' type='password' aria-label="confirm password" placeholder="Confirm Password">
                <input id='regFirstName' class='form-control mt-2' type='text' aria-label="first name" placeholder="First Name">
                <input id='regLastName' class='form-control mt-2' type='text' aria-label="last name" placeholder="Last Name">
                <button class='btn btn-primary col-12 mt-2' type='button' id='btnRegister' aria-label='register button'>Register</button>
                <p class="text-center mt-2">Already have an account? <a href="#" id="lnkLogin">Login</a></p>
            </div>
        </form>

        <!--Login-->
        <form class = 'card col-12 col-md-5' id='frmLogin' style='display: none;'>
            <div class= 'card-body'>
                <h2 class = 'text-center text-primary'>Login</h2>
                <input id='loginEmail'  class='form-control mt-2' type='email' aria-label="email" placeholder="Email">
                <input id='loginPassword' class='form-control mt-2' type='password' aria-label="password" placeholder="Password">
                <button class='btn btn-primary col-12 mt-2' type='button' id='btnLogin' aria-label='login button'>Login</button>
                <p class="text-center mt-2">Don't have an account? <a href="#" id="lnkRegister">Register</a></p>
            </div>
        </form>

        <form class='card col-12 col-md-7 col-lg-5' id='frmSurvey' style="display: none"> <!--Survey page-->
            <div class='card-body'>
                <!--Header-->
                <div class='d-flex justify-content-center align-items-center'>
                    <h2 class='text-center mt-0 text-primary' aria-label='header reading "electronic medical records system"'>
                        <strong>Group Survey</strong>
                    </h2>
                </div>
                
                <hr />
                
                <!--Survey-->
                <h4 class='text-info' aria-label='account information header'><strong>Rate Yourself</strong></h4>
                <div>
                    <input id='txtEmailSelf' class='form-control mt-2' type='email' placeholder='aeagle42@tntech.edu' aria-label='input for email'>
                    
                    <p class = 'mt-2 mb-0'>Rate your performance</p>
                    <select id = 'selScoreSelf' class='form-select' aria-label='Dropdown for rating your performance from 1-10'>
                        <option selected>Open this select menu</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                      </select>  
                      
                      <p class = 'mt-2 mb-0'>Details supporting your assesment of your performance.</p>
                      <textarea id='txtDetailsSelf' class='form-control' aria-label='With textarea'></textarea>
                      
                      <p class = 'mt-2 mb-0'>What grade do you believe you deserve on this portion of the course?</p>
                      <input id='txtGradeSelf' class='form-control mt-2 mb-2' aria-label='input for grade'>
                </div>

                <hr />

                <h4 class='text-info' aria-label='account information header'><strong>Team member 1</strong></h4>
                <div>
                    <input id='txtEmail1' class='form-control mt-2' type='email' placeholder='aeagle42@tntech.edu' aria-label='input for email'>
                    
                    <p class = 'mt-2 mb-0'>How would you rate team member 1's performance on the assignment?</p>
                    <select id = 'score1' class='form-select' aria-label='Dropdown for rating your performance from 1-10'>
                        <option selected>Open this select menu</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                      </select>  
                      
                      <p class = 'mt-2 mb-0'>Details supporting your assesment of team member 1's performance.</p>
                      <textarea id='txtDetails1' class='form-control' aria-label='With textarea'></textarea>
                </div>

                <hr />
                
                <button class='btn btn-primary col-12 mt-0' type='button' id='btnSubmit' aria-label='submit button'>Submit</button>
            </div>
        </form>
        <form class='card col-12 col-md-7 col-lg-5' id='frmDashboard' style='display: none;'> <!--Just a page for fun-->
            <!--Just to clarify chihuahuaspin.com does NOT belong to me. I jast wanted to test somethings out for making a dashboard
            for users to land on after logging in. This is meant to be some enterntainment in the assignment ONLY and I take NO
            ownership of chihuahuaspin.com, it's code, or assets.-->
            <div class='card-body'>
                <!--Header, gif, and subheader-->
                <h2 class='text-center mt-0 text-primary' aria-label='header reading "Thank you for your submission!"'>
                    <strong>Thank you for your submission!</strong>
                </h2>
                <h4 class='text-center text-secondary' aria-label='subheader reading "Watch this dog now"'>Watch this dog now</h4>

                <hr />

                <div class='d-flex justify-content-center align-items-center'>
                    <!--The gif belongs to chihuahuaspin.com-->
                    <img src='images/spin.gif' alt='chihuahua wrapped in bubble wrap spinning' style='max-width: 90%;'>
                    <div id="ethan" style="position: absolute; top: 12px; right: 2px; width: 80px; background-color: #aaa; color: #f00; padding: 5px; display: none">
                        You are officially Ethan :-)
                    </div>
                </div>
                <center>
                    <h4 class='align-items-center'>You have sat through <span id="spin">0 spins</span>!</h4>
                </center>

                <hr />
                
                <button class='btn btn-primary col-12 mt-0' type='button' id='btnReturn' aria-label='button to retrun to survey'>Return to survey</button>
            </div>
        </form>
    </div>
    <script src='https://code.jquery.com/jquery-3.7.1.min.js' integrity='sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=' crossorigin='anonymous'></script>
    <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js' integrity='sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz' crossorigin='anonymous'></script>
    <script src='https://cdn.jsdelivr.net/npm/sweetalert2@11'></script>
    <script>
        $('#lnkLogin').click(() => { $('#frmRegister').hide(); $('#frmLogin').show(); $('#frmSurvey').hide(); });
        $('#lnkRegister').click(() => { $('#frmLogin').hide(); $('#frmRegister').show(); $('#frmSurvey').hide(); });

        $('#btnRegister').click(() => {
            let blnError = false;
            let strMessage = ''; 
            let email = $('#regEmail').val().trim();
            let password = $('#regPassword').val();
            let passwordConfirm = $('#regPasswordConfirm').val();
            let firstName = $('#regFirstName').val().trim();
            let lastName = $('#regLastName').val().trim();
            const regemail = /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)*tntech\.edu$/

            // Checks for errors in the registration form
            if (!regemail.test(email)) {
                    blnError = true
                    strMessage += '<p class="mt-0 mb-0">Please enter a tech email</p>'
            } 
            if (password != passwordConfirm) {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Passwords do not match</p>';
            }
            if (password.length < 8) {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Password must be at least 8 characters</p>';
            }
            if (firstName == '' || lastName == '') {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Please enter a first and last name</p>';
            }

            
            if (blnError) {
                Swal.fire({
                    title: 'Oh no, you have an error!',
                    html: strMessage,
                    icon: 'error'
                })
            } else {
                Swal.fire({
                    title: 'Success',
                    text: 'You have successfully registered',
                    icon: 'success'
                });
                // Temptorary solution for storing user data. Will be replaced with a database
                localStorage.setItem('email', email);
                localStorage.setItem('password', password);
                $('#frmRegister').hide();
                $('#frmLogin').show();
            }
        })

        $('#btnLogin').click(() => {
            let email = $('#loginEmail').val().trim();
            let password = $('#loginPassword').val();
            let blnError = false;
            const regemail = /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)*tntech\.edu$/
            
            if (email == '' || password == '') {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Please enter an email and password</p>'
            } 
            if (!regemail.test(email)) {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Please enter a tech email</p>'
            }
            if (email != localStorage.getItem('email') && password != localStorage.getItem('password')) {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Invalid login</p>'
            }

            if (blnError) {
                Swal.fire({
                    title: 'Oh no, you have an error!',
                    html: strMessage,
                    icon: 'error'
                })
            } else {
                Swal.fire({
                    title: 'Success',
                    text: 'You have successfully logged in',
                    icon: 'success'
                });
                $('#frmLogin').hide();
                $('#frmSurvey').show();
            }
        })

        // This script is for the registration form
        document.querySelector('#btnSubmit').addEventListener('click', (e) => {
            let strEmailSelf = document.querySelector('#txtEmailSelf').value
            let strScoreSelf = document.querySelector('#selScoreSelf').value
            let strDetailsSelf = document.querySelector('#txtDetailsSelf').value
            let strGradeSelf = document.querySelector('#txtGradeSelf').value

            let blnError = false
            let strMessage = ''

            // Regular expressions for email
            const regemail = /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)*tntech\.edu$/
            strEmailSelf = strEmailSelf.toLowerCase()

            // I feel like there should be an easier/shorter way to run all of these checks
            if (!regemail.test(strEmailSelf)) {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Email must be a tech email</p>'
            }

            if (strScoreSelf == 'Open this select menu') {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Please select a score</p>'
            }
            // Incomplete checks

            //SweetAlert for Dashboardful or failed registration
            if (blnError) {
                Swal.fire({
                    title: 'Oh no, you have an error!',
                    html: strMessage,
                    icon: 'error'
                })
            } else {
                Swal.fire({
                    title: 'Success!',
                    text: 'You have successfully logged in',
                    icon: 'success'
                }).then(() => {
                    $('#frmSurvey').slideUp('slow', () => {
                        $('#frmDashboard').slideDown('slow')
                        /* This script belong to chihuahuaspin.com and I take NO ownership of it. 
                        Again this code belongs to chihuahuaspin.com and I do NOT claim to own it.*/    
                        let spins = 0
                        setInterval(function () {
                            spins++
                            $('#spin').text(spins + " spin" + (spins != 1 ? "s" : ""))
                            if (spins == 10)
                            $("#ethan").show()
                            else if (spins == 17)
                            $("#ethan").hide()
                        }, 4205)
                        // hearts to Ethan, Neal, and Shawn
                    })
                })

                // Swal.fire({
                //     title: 'Success!',
                //     text: 'You have successfully submitted your survey!',
                //     icon: 'success'
                // })
            }
        })

        // This script signs the user out of the dashboard
        $('#btnReturn').on('click', function(){
            $('#frmDashboard').slideUp('slow', () => {
                $('#frmSurvey').slideDown('slow')
            })
        })
    </script>
</body>
</html>