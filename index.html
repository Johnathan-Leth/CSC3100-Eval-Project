<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Group Survey</title>
    <link rel='icon' href='images/hippoLogo.png' type='image/png'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH' crossorigin='anonymous'>
    <link href='https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/yeti/bootstrap.min.css' rel='stylesheet'>
</head>

<!--Form container for better code readability-->
<body class='bg-dark'>
    <div id='frmContainer'></div>

    <!--Scripts-->
    <script src='https://code.jquery.com/jquery-3.7.1.min.js' integrity='sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=' crossorigin='anonymous'></script>
    <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js' integrity='sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz' crossorigin='anonymous'></script>
    <script src='https://cdn.jsdelivr.net/npm/sweetalert2@11'></script>
    <script>
        // Variables
        let strMessage = ''
        let email = ''
        let password = ''
        let passwordConfirm = ''
        let firstName = ''
        let lastName = ''
        let position = ''
        let accessCode = ''
        const regemail = /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)*tntech\.edu$/

        // Greater logic for changing between forms
        function loadPage(page) {
            $('#frmContainer').load(page, () => {
                console.log(`Loaded ${page}`)
            })
        }

        // Login page by default
        $(document).ready(() => {
            loadPage('login.html')
        })

        // Event listeners for form navigation
        $(document).on('click', '#lnkRegister', () => {
            event.preventDefault()
            loadPage('register.html')
            console.log('Register link clicked')
        })
        $(document).on('click', '#lnkRegisterProf', () => {
            event.preventDefault()
            loadPage('registerProf.html')
            console.log('Register Prof link clicked')
        })
        $(document).on('click', '#lnkLogin', () => {
            event.preventDefault()
            loadPage('login.html')
            console.log('Login link clicked')
        })

        // Default Registration logic
        $(document).on('click', '#btnRegister', () => {
            let blnError = false
            let strMessage = ''
            email = $('#regEmail').val().trim()
            password = $('#regPassword').val()
            passwordConfirm = $('#regPasswordConfirm').val()
            firstName = $('#regFirstName').val().trim()
            lastName = $('#regLastName').val().trim()
            position = 'Student'

            // Checks for errors in the registration form
            if (!regemail.test(email)) {
                    blnError = true
                    strMessage += '<p class="mt-0 mb-0">Please enter a tech email</p>'
            } 
            if (password != passwordConfirm) {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Passwords do not match</p>';
            }
            if (password.length < 8) {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Password must be at least 8 characters</p>';
            }
            if (firstName == '' || lastName == '') {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Please enter a first and last name</p>';
            }
            if (position == 'Select your position') {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Please select a position</p>';
            }

            console.log('Register button clicked')

            
            if (blnError) {
                Swal.fire({
                    title: 'Oh no, you have an error!',
                    html: strMessage,
                    icon: 'error'
                })
            } else {
                Swal.fire({
                    title: 'Success',
                    text: 'You have successfully registered',
                    icon: 'success'
                });
                // Temptorary solution for storing user data. Will be replaced with a database
                sessionStorage.setItem('email', email);
                sessionStorage.setItem('password', password);
                sessionStorage.setItem('position', position)
                loadPage('login.html')
            }
        })

        // Professor Registration logic
        $(document).on('click', '#btnRegisterProf', () => {
            let blnError = false
            let strMessage = ''
            email = $('#regEmailProf').val().trim()
            password = $('#regPasswordProf').val()
            passwordConfirm = $('#regPasswordConfirmProf').val()
            firstName = $('#regFirstNameProf').val().trim()
            lastName = $('#regLastNameProf').val().trim()
            accessCode = $('#regAccessCode').val()
            position = 'Professor'
            
            // Checks for errors in the registration form
            if (!regemail.test(email)) {
                    blnError = true
                    strMessage += '<p class="mt-0 mb-0">Please enter a tech email</p>'
            } 
            if (password != passwordConfirm) {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Passwords do not match</p>';
            }
            if (password.length < 8) {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Password must be at least 8 characters</p>';
            }
            if (firstName == '' || lastName == '') {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Please enter a first and last name</p>';
            }
            if (accessCode != '10204' || accessCode.length() != 6) {
                blnError = true;
                strMessage += '<p class="mt-0 mb-0">Incorrect code</p>';
            }

            console.log('Register button clicked')

            
            if (blnError) {
                Swal.fire({
                    title: 'Oh no, you have an error!',
                    html: strMessage,
                    icon: 'error'
                })
            } else {
                Swal.fire({
                    title: 'Success',
                    text: 'You have successfully registered',
                    icon: 'success'
                });
                // Temptorary solution for storing user data. Will be replaced with a database
                sessionStorage.setItem('email', email);
                sessionStorage.setItem('password', password);
                sessionStorage.setItem('position', position)
                loadPage('login.html')
            }
        })
        
        // Login logic
        $(document).on('click', '#btnLogin', () => {
            email = $('#loginEmail').val().trim()
            password = $('#loginPassword').val()
            let blnError = false
            let strMessage = ''
            
            if (email == '' || password == '') {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Please enter an email and password</p>'
            } 
            if (!regemail.test(email)) {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Please enter a tech email</p>'
            }
            if (email != sessionStorage.getItem('email') && password != sessionStorage.getItem('password')) {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Invalid login</p>'
            }

            console.log('Login clicked')

            if (blnError) {
                Swal.fire({
                    title: 'Oh no, you have an error!',
                    html: strMessage,
                    icon: 'error'
                })
            } else {
                Swal.fire({
                    title: 'Success',
                    text: 'You have successfully logged in',
                    icon: 'success'
                });
                loadPage('survey.html')
            }
        })

        // Survey submission logic
        $(document).on('click', '#btnSubmit', () => {
            let strEmailSelf = $('#txtEmailSelf').val().trim()
            let strScoreSelf = $('#selScoreSelf').val()
            let strDetailsSelf = $('#txtDetailsSelf').val()
            let strGradeSelf = $('#txtGradeSelf').val().trim()

            let blnError = false
            let strMessage = ''
            const regemail = /^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)*tntech\.edu$/
            strEmailSelf = strEmailSelf.toLowerCase()

            // I feel like there should be an easier/shorter way to run all of these checks
            if (!regemail.test(strEmailSelf)) {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Email must be a tech email</p>'
            }

            if (strScoreSelf == 'Open this select menu') {
                blnError = true
                strMessage += '<p class="mt-0 mb-0">Please select a score</p>'
            }
            // Incomplete checks

            //SweetAlert for Dashboardful or failed registration
            if (blnError) {
                Swal.fire({
                    title: 'Oh no, you have an error!',
                    html: strMessage,
                    icon: 'error'
                })
            } else {
                Swal.fire({
                    title: 'Success!',
                    text: 'You have successfully logged in',
                    icon: 'success'
                }).then(() => {
                    loadPage('dashboard.html')
                })
            }
        })

        // This script signs the user out of the dashboard
        $('#btnReturn').on('click', function(){
            $('#frmDashboard').slideUp('slow', () => {
                $('#frmSurvey').slideDown('slow')
            })
        })
    </script>
</body>
</html>